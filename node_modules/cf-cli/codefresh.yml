---
  version: "1.0"
  steps:
    test-step:
      fail-fast: false
      image: "node:latest"
      working-directory: ${{initial-clone}}
      commands:
        - "npm install -g better-npm-run"
        - "npm install -g mocha"
        - "npm install"
        - "mocha ./commands/yaml"

    security-by-snyk:
      fail-fast: false
      image: "node:latest"
      working-directory: ${{initial-clone}}
      commands:
        - "npm install -g snyk"
        - "snyk test"

    publish-npm:
          fail-fast: false
          image: "node:latest"
          working-directory: ${{initial-clone}}
          environment :
             - NPM_USERNAME =${{NPM_USER}}
             - NPM_PASSWORD= ${{NPM_PASSWORD}}
             - NPM_EMAIL=verchol@gmail.com
          commands:
            - "npm install -g gulp"
            - "gulp bump"
            - "echo //registry.npmjs.org/:_password=${NPM_PASSWORD}>> ~/.npmrc"
            - "echo //registry.npmjs.org/:username=${NPM_USERNAME}>> ~/.npmrc"
            - "echo //registry.npmjs.org/:email=${NPM_EMAIL}>> ~/.npmrc"
            - "gulp npm"


    build-docker-image:
             type: "build"
             fail-fast: false
             dockerfile: "Dockerfile"
             image-name: "verchol/cf-cli"
             tag: "latest"
